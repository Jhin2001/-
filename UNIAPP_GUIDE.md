# 药房排队大屏端 (UniApp) - 通用部署指南

本文档介绍如何使用 UniApp 打包一个**通用**的 Android TV 安装包。
新的架构支持**“一次打包，处处运行”**，同时也支持**硬编码地址**以实现零配置开机自启。

## 1. 核心特性

*   **自动生成 ID**: App 首次启动时会自动生成一个唯一的 `DeviceID` (例如 `TV-X82A`)。
*   **双模式配置**: 
    1.  **硬编码 (推荐)**: 在代码中写死 IP，打包后安装即用，完全无需操作。
    2.  **动态配置**: 首次启动输入 IP，后续自动记忆（持久化存储）。

## 2. 环境准备与导入

1.  下载并安装 [HBuilderX (App开发版)](https://www.dcloud.io/hbuilderx.html)。
2.  **关键步骤**: 打开 HBuilderX，选择 **`文件 -> 打开目录`**。
3.  **只选择项目中的 `uniapp` 子文件夹**。
    *   *错误做法*: 打开整个 `PharmacyQueue` 文件夹。
    *   *正确做法*: 只打开 `PharmacyQueue/uniapp` 文件夹。
    *   *成功标志*: HBuilderX 左侧项目栏显示项目名称，图标带有 "U" 标识。
4.  打开 `manifest.json`，点击“基础配置”，点击 **AppID** 旁的“重新获取”以绑定您的账号。

## 3. 配置方式选择

在打包前，请打开 `pages/index/index.vue` 文件，根据需求选择一种方式。

### 方式一：硬编码地址 (推荐 - 适合 IP 固定的场景)
如果您不想每次安装都输入地址，可以直接在代码中填入。

1.  打开 `pages/index/index.vue`。
2.  找到顶部的 `DEFAULT_SERVER_URL` 常量。
3.  填入您的服务器地址：
    ```javascript
    const DEFAULT_SERVER_URL = 'http://192.168.1.100:8081';
    ```
4.  **效果**: App 启动后**直接进入大屏页面**，不会显示任何配置界面。

### 方式二：动态配置 (适合 IP 不确定或多院区场景)
如果您希望同一个 APK 可以灵活配置到不同服务器：

1.  保持常量为空：
    ```javascript
    const DEFAULT_SERVER_URL = '';
    ```
2.  **效果**: 
    *   **首次启动**: 显示输入框，需用遥控器/鼠标输入 IP。
    *   **后续启动**: **自动读取缓存，直接进入大屏**。无需再次输入（除非手动清除数据或点击重置）。

## 4. 打包 APK

1.  点击顶部菜单 **发行** -> **原生App-云打包**。
2.  证书选择 **使用公共测试证书** (或您自己的证书)。
3.  点击 **打包**。
4.  等待生成 `apk` 文件。

## 5. 现场部署流程

将生成的 `apk` 文件拷贝到 U 盘，插入电视/机顶盒进行安装。

### 如果使用了方式一 (硬编码)
1.  打开 App。
2.  直接进入大屏展示页面。
3.  记下屏幕左上角的 DeviceID，去后台绑定即可。

### 如果使用了方式二 (动态配置)
1.  打开 App。
2.  屏幕显示 **“终端初始化配置”** 界面。
3.  输入服务器 IP 地址 (例如 `http://192.168.1.100:8081`)。
4.  点击 **“连接并启动”**。
5.  系统会自动保存此地址，**下次开机自动连接**。

## 6. 如何重置配置？

*   **方法 A**: 点击屏幕左上角的半透明 ⚙️ 设置图标。
    *   如果是硬编码模式，只会显示信息，无法重置。
    *   如果是动态模式，点击“重置配置”即可重新输入。
*   **方法 B**: 在电视系统设置中清除 App 数据。
